
gcloud compute firewall-rules create www-firewall-network-lb \
> --network=default \
> --allow=tcp:80 \
> --target-tags=network-lb-tag

gcloud compute instances create web1 \
> --zone=us-west3-a \
> --tags=network-lb-tag \
> --image-family=debian-12 \
> --machine-type=e2-small \
> --image-project=debian-cloud \
> --metadata=startup-script='#!/bin/bash
apt-get update
apt-get install apache2 -y
service apache2 restart
echo "<h3>Web Server: web1</h3>" | tee /var/www/html/index.html'

gcloud compute addresses create network-lb-ip-1 \
> --region=us-west3

gcloud compute target-pools create www-pool \
> --region=us-west3

gcloud compute target-pools add-instances www-pool \
> --instances=web1,web2,web3 \
> --zone=us-west3-a

gcloud compute forwarding-rules create network-lb-forwarding-rule \
> --region=us-west3 \
> --ports=80 \
> --address=network-lb-ip-1 \
> --target-pool=www-pool

gcloud compute http-health-checks create basic-check \
> --port=80

gcloud compute target-pools add-health-checks www-pool \
> --http-health-check=basic-check \
> --region=us-west3

gcloud compute instance-templates create lb-backend-template \
> --machine-type=e2-medium \
> --tags=allow-health-check \
> --image-family=debian-12 \
> --image-project=debian-cloud \
> --metadata=startup-script='#!/bin/bash
apt-get update
apt-get install apache2 -y
service apache2 restart
echo "<h3>Web Server: $(hostname)</h3>"



gcloud compute instance-groups managed create lb-backend-group \
> --zone=us-west3-a \
> --template=lb-backend-template \
> --size=2

gcloud compute instance-groups managed set-named-ports lb-backend-group \
> --named-ports=http:80 \
> --zone=us-west3-a

gcloud compute firewall-rules create fw-allow-health-check \
> --network=default \
> --direction=INGRESS \
> --action=allow \
> --rules=tcp:80 \
> --source-ranges=130.211.0.0/22,35.191.0.0/16

gcloud compute health-checks create http http-basic-check \
> --port=80


gcloud compute backend-services create web-backend-service \
> --protocol=HTTP \
> --health-checks=http-basic-check \
> --global

gcloud compute backend-services add-backend web-backend-service --instance-group=lb-b
ackend-group --instance-group-zone=us-west3-a --global

gcloud compute url-maps create web-map-http \
> --default-service=web-backend-service

gcloud compute target-http-proxies create http-lb-proxy --url-map=web-map-http

gcloud compute addresses create lb-ipv4-1 \
> --global \
> --ip-version=IPV4


gcloud compute forwarding-rules create http-forwarding-rule --global --address=lb-ipv4-1 --target-http-proxy=http-lb-proxy --ports=80







